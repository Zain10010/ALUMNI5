{% extends "base.html" %}

{% block head %}
<meta http-equiv="refresh" content="30">
{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <div class="dashboard-card">
        <h3><i class="fas fa-users"></i> Total Alumni</h3>
        <p>Currently managing {{ total_alumni }} alumni records</p>
        <a href="{{ url_for('alumni_list') }}" class="btn btn-primary">
            <i class="fas fa-list"></i> View All Alumni
        </a>
    </div>
    
    <div class="dashboard-card">
        <h3><i class="fas fa-user-graduate"></i> Alumni Management</h3>
        <p>Manage and view all alumni records</p>
        <a href="{{ url_for('alumni_list') }}" class="btn btn-primary">
            <i class="fas fa-users"></i> Manage Alumni
        </a>
    </div>
    
    <div class="dashboard-card">
        <h3><i class="fas fa-plus-circle"></i> Add New Alumni</h3>
        <p>Register a new alumni member</p>
        <a href="{{ url_for('add_alumni') }}" class="btn btn-primary">
            <i class="fas fa-user-plus"></i> Add Alumni
        </a>
    </div>
    
    <div class="dashboard-card">
        <h3><i class="fas fa-building"></i> Alumni by Department</h3>
        <p>View alumni organized by their departments</p>
        <a href="{{ url_for('alumni_by_department') }}" class="btn btn-primary">
            <i class="fas fa-sitemap"></i> View by Department
        </a>
    </div>
</div>

<div class="table-container">
    <h2><i class="fas fa-clock"></i> Recent Alumni</h2>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Department</th>
                <th>Graduation Year</th>
                <th>Current Employer</th>
                <th>Job Title</th>
            </tr>
        </thead>
        <tbody>
            {% for alumni in recent_alumni %}
            <tr>
                <td><a href="{{ url_for('alumni_profile', id=alumni.id) }}" style="color: var(--accent-blue); text-decoration: none;">{{ alumni.first_name }} {{ alumni.last_name }}</a></td>
                <td>{{ alumni.department }}</td>
                <td>{{ alumni.graduation_year }}</td>
                <td>{{ alumni.current_employer or 'Not provided' }}</td>
                <td>{{ alumni.job_title or 'Not provided' }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="table-container">
    <h2><i class="fas fa-chart-pie"></i> Graduation Year Distribution</h2>
    <table>
        <thead>
            <tr>
                <th>Year</th>
                <th>Number of Alumni</th>
            </tr>
        </thead>
        <tbody>
            {% for year, count in graduation_years %}
            <tr>
                <td>{{ year }}</td>
                <td>{{ count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

        <script>
        // Auto-refresh dashboard data every 30 seconds
        function autoRefreshDashboard() {
            setTimeout(() => {
                window.location.reload();
            }, 30000); // 30 seconds
        }

        // Start auto-refresh when page loads
        document.addEventListener('DOMContentLoaded', function() {
            autoRefreshDashboard();
            
            // Also refresh when user becomes active (clicks, scrolls, etc.)
            let userActivity = false;
            const events = ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'];
            
            events.forEach(event => {
                document.addEventListener(event, () => {
                    userActivity = true;
                });
            });
            
            // Reset activity flag every 5 seconds
            setInterval(() => {
                if (userActivity) {
                    userActivity = false;
                    // Refresh data when user is active
                    fetch('/dashboard')
                        .then(response => response.text())
                        .then(html => {
                            // Update only the content area without full page reload
                            const parser = new DOMParser();
                            const newDoc = parser.parseFromString(html, 'text/html');
                            const newContent = newDoc.querySelector('.dashboard-grid, .table-container');
                            const currentContent = document.querySelector('.dashboard-grid, .table-container');
                            if (newContent && currentContent) {
                                currentContent.innerHTML = newContent.innerHTML;
                            }
                        })
                        .catch(error => {
                            console.log('Auto-refresh error:', error);
                        });
                }
            }, 5000);
        });
        </script>
{% endblock %} 